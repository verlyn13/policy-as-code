{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Infisical Identities Configuration",
  "type": "object",
  "required": ["project_slug", "identities"],
  "properties": {
    "project_slug": {
      "type": "string",
      "pattern": "^[a-z0-9-]+$"
    },
    "identities": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name", "type", "project_role", "environment", "auth_method"],
        "properties": {
          "name": {
            "type": "string",
            "pattern": "^[a-z0-9-]+@[a-z0-9-]+-[a-z]+$",
            "description": "Identity name in format: service@project-env"
          },
          "type": {
            "type": "string",
            "enum": ["runtime", "ci", "rotator", "admin"]
          },
          "project_role": {
            "type": "string",
            "enum": ["runtime", "ci", "security-ops-prj", "admin"]
          },
          "environment": {
            "type": "string",
            "enum": ["dev", "stg", "prod"]
          },
          "auth_method": {
            "type": "object",
            "oneOf": [
              {
                "type": "object",
                "required": ["type"],
                "properties": {
                  "type": {
                    "const": "universal"
                  },
                  "client_secret_ttl": {
                    "type": "integer",
                    "minimum": 300,
                    "maximum": 86400
                  },
                  "access_token_ttl": {
                    "type": "integer",
                    "minimum": 300,
                    "maximum": 3600
                  },
                  "access_token_max_ttl": {
                    "type": "integer",
                    "minimum": 300,
                    "maximum": 86400
                  },
                  "access_token_trusted_ips": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "pattern": "^([0-9]{1,3}\\.){3}[0-9]{1,3}(/[0-9]{1,2})?$|^::/[0-9]{1,3}$|^([0-9a-fA-F]{0,4}:){1,7}[0-9a-fA-F]{0,4}(/[0-9]{1,3})?$"
                    }
                  }
                }
              },
              {
                "type": "object",
                "required": ["type"],
                "properties": {
                  "type": {
                    "const": "oidc"
                  },
                  "issuer": {
                    "type": "string",
                    "format": "uri"
                  },
                  "audiences": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "minItems": 1
                  },
                  "subject_mappings": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "pattern": "^repo:"
                    },
                    "minItems": 1
                  },
                  "access_token_ttl": {
                    "type": "integer",
                    "minimum": 300,
                    "maximum": 1800
                  }
                }
              },
              {
                "type": "object",
                "required": ["type"],
                "properties": {
                  "type": {
                    "const": "token"
                  },
                  "token_ttl": {
                    "type": "integer",
                    "minimum": 300,
                    "maximum": 1800
                  },
                  "token_max_ttl": {
                    "type": "integer",
                    "minimum": 300,
                    "maximum": 1800
                  }
                }
              }
            ]
          },
          "bindings": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["role", "paths"],
              "properties": {
                "role": {
                  "type": "string"
                },
                "paths": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "pattern": "^/"
                  },
                  "minItems": 1
                }
              }
            }
          }
        }
      },
      "minItems": 1
    }
  }
}